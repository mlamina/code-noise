{% extends "base.html.jinja2" %}

{% block title %}Home{% endblock %}

{% block content %}
    <h2>Background Noise Generator</h2>
    <div>
        <label for="volume">Volume:</label>
        <input type="range" id="volume" name="volume" min="0" max="1" step="0.01" value="0.5">
    </div>
    <div>
        <label for="frequency">Frequency:</label>
        <input type="range" id="frequency" name="frequency" min="20" max="20000" step="1" value="440">
    </div>
    <button id="play">Play</button>
    <button id="stop">Stop</button>

    <script>
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let gainNode = audioContext.createGain();
        let bufferSize = 2 * audioContext.sampleRate;
        let noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
        let output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1;
        }

        document.getElementById('play').addEventListener('click', function() {
            let whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = noiseBuffer;
            whiteNoise.loop = true;
            whiteNoise.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(document.getElementById('volume').value, audioContext.currentTime);
            whiteNoise.start();
        });

        document.getElementById('stop').addEventListener('click', function() {
            audioContext.close().then(function() {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioContext.createGain();
            });
        });

        document.getElementById('volume').addEventListener('input', function() {
            gainNode.gain.setValueAtTime(this.value, audioContext.currentTime);
        });
    </script>
{% endblock %}
